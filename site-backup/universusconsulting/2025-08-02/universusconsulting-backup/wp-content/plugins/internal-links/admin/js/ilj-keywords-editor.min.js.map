{"version":3,"file":"ilj-keywords-editor.min.js","mappings":"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","sources":["webpack://wp-internal-linkjuicer/./src/admin/js/ilj-keywords-editor.js"],"sourcesContent":["/*!*********************************************!*\\\n  !*** ./src/admin/js/ilj-keywords-editor.js ***!\n  \\*********************************************/\njQuery(function ($) {\n  // Debounce the events emitted from select2 input, to prevent multiple ajax calls.\n  function debounce(func, delay) {\n    var timeout_id;\n    return function () {\n      var context = this;\n      var args = arguments;\n      clearTimeout(timeout_id);\n      timeout_id = setTimeout(function () {\n        func.apply(context, args);\n      }, delay);\n    };\n  }\n  function check_keyword_duplicate(e, current_element) {\n    // Get the full comma-separated value\n    var all_values = $(current_element).val();\n    // Check if it's an array (multiple select) or a single value\n    var last_keyword;\n    if (Array.isArray(all_values)) {\n      last_keyword = all_values[all_values.length - 1]; // Get the last keyword in the array\n    } else if ('string' === typeof all_values) {\n      // Handle as a single comma-separated string\n      var keywords_array = all_values.split(',');\n      last_keyword = keywords_array[keywords_array.length - 1].trim();\n    } else {\n      console.error(\"Unexpected value type: \", typeof all_values);\n      return;\n    }\n    var item_id = $(current_element).data('ilj-item-id');\n    var item_type = $(current_element).data('ilj-item-type');\n\n    // Check for duplicate function\n    if (null != last_keyword) {\n      var data = {\n        'action': 'ilj_check_duplicate_keyword',\n        'keyword': last_keyword,\n        'nonce': ilj_editor_duplicate.nonce,\n        'item-id': item_id,\n        'item-type': item_type\n      };\n      $.ajax({\n        url: ajaxurl,\n        type: \"POST\",\n        data: data,\n        statusCode: {\n          500: function (xhr) {\n            if (!\"responseJSON\" in xhr || ![\"success\", \"error\"].includes(xhr.responseJSON.status)) {\n              return;\n            }\n          }\n        },\n        success: function (data, textStatus, xhr) {\n          if (false == data) {\n            return false;\n          } else {\n            $(e.currentTarget).closest('tr').find('.ilj-duplicate-notice').html(data);\n            $(e.currentTarget).closest('tr').find('.ilj-duplicate-notice').show();\n          }\n        }\n      });\n    }\n  }\n  $('.ilj-keywords-editor-select-box').ilj_select2({\n    minimumResultsForSearch: 10,\n    width: '50%',\n    tags: true,\n    tokenSeparators: [',']\n  });\n  var handle_option_change = debounce(function (e, is_select) {\n    var selected_values = [];\n    if (is_select) {\n      check_keyword_duplicate(e, this);\n    }\n    $(e.currentTarget).find('option:selected').each(function () {\n      selected_values.push($(this).val());\n    });\n\n    /**\n     * The current version of select2 loses focus when the option is selected, so we need to\n     * set focus on search field again.\n     * @see https://github.com/select2/select2/issues/5185\n     */\n    $(e.currentTarget).next('.ilj-select2-container').find('.ilj-select2-search__field').focus();\n    var spinner = $(e.currentTarget).closest('tr').find('.spinner');\n    spinner.addClass('is-active');\n    $.ajax({\n      url: $(e.currentTarget).data('iljSaveUrl'),\n      type: 'POST',\n      data: {\n        keywords: selected_values\n      }\n    }).always(function () {\n      spinner.removeClass('is-active');\n    });\n  }, 100);\n\n  // Attach the event handlers with specific parameters for select and unselect\n  $('.ilj-keywords-editor-select-box').on('select2:select', function (e) {\n    handle_option_change.call(this, e, true);\n  });\n  $('.ilj-keywords-editor-select-box').on('select2:unselect', function (e) {\n    handle_option_change.call(this, e, false);\n  });\n  $('.ilj-keywords-editor-select-box').on('select2:unselect', function (e) {\n    var unselected_tag = e.params.data.id;\n\n    // Remove the unselected tag from the dropdown options\n    var select_box = $(this);\n    var options = select_box.find('option[value=\"' + unselected_tag + '\"]');\n    options.remove();\n\n    // Ensure the unselected tag is completely removed from the value list\n    var current_values = select_box.val() || [];\n    var new_values = current_values.filter(value => value !== unselected_tag);\n    select_box.val(new_values).trigger('change');\n  });\n  $(document).on('click', '.ilj-duplicate-details', function (event) {\n    event.preventDefault(); // Prevent default behavior, if any\n    event.stopPropagation(); // Stop propagation, if necessary\n\n    var keyword = $(this).data('keyword');\n    var duplicate_count = $(this).data('duplicate-count');\n    var headline = ilj_editor_translation.keyword_duplicate_title;\n    var title = keyword;\n    var item_id = $(this).data('ilj-item-id');\n    var item_type = $(this).data('ilj-item-type');\n    var data = {\n      'action': 'ilj_render_duplicate_keyword_details',\n      'keyword': keyword,\n      'nonce': ilj_editor_duplicate.nonce,\n      'item-id': item_id,\n      'item-type': item_type\n    };\n    $.ajax({\n      url: ajaxurl,\n      type: 'POST',\n      data: data\n    }).done(function (data) {\n      ilj_create_modal(headline + ' \"' + title + '\" (' + duplicate_count + ')', $('<div/>').addClass('ilj-duplicates').html(data));\n    });\n  });\n\n  /**\n   * Dismiss the notice\n   */\n  $(document).on('click', '.ilj-dismiss-notice', function () {\n    $(this).closest('.ilj-duplicate-notice').hide();\n  });\n});\n"],"names":["jQuery","$","ilj_select2","minimumResultsForSearch","width","tags","tokenSeparators","func","delay","timeout_id","handle_option_change","e","is_select","selected_values","current_element","last_keyword","all_values","val","Array","isArray","length","console","error","keywords_array","split","trim","item_id","data","item_type","ilj_editor_duplicate","nonce","ajax","url","ajaxurl","type","statusCode","xhr","includes","responseJSON","status","success","textStatus","currentTarget","closest","find","html","show","check_keyword_duplicate","this","each","push","next","focus","spinner","addClass","keywords","always","removeClass","context","args","arguments","clearTimeout","setTimeout","apply","on","call","unselected_tag","params","id","select_box","remove","new_values","filter","value","trigger","document","event","preventDefault","stopPropagation","keyword","duplicate_count","headline","ilj_editor_translation","keyword_duplicate_title","title","done","ilj_create_modal","hide"],"sourceRoot":""}